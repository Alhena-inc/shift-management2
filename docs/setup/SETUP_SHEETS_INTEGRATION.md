# Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆçµ±åˆ - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

## æ¦‚è¦

ã‚·ãƒ•ãƒˆç®¡ç†ã‚½ãƒ•ãƒˆã«Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’åŸ‹ã‚è¾¼ã¿ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ æ™‚ã«è‡ªå‹•çš„ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åˆ—ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½ã®å®Ÿè£…ã§ã™ã€‚

## å®Ÿè£…å†…å®¹

### 1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®iframeåŸ‹ã‚è¾¼ã¿

`ShiftTable.tsx` ã§ã€æ—¢å­˜ã®Reactã‚°ãƒªãƒƒãƒ‰ã‚’Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®iframeã«ç½®ãæ›ãˆã¾ã—ãŸã€‚

- **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL**: https://docs.google.com/spreadsheets/d/1hrNbQ3X9bkFqNe3zoZgs3vQF54K2rmFxXNJm_0Xg5m0/edit
- **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID**: `1hrNbQ3X9bkFqNe3zoZgs3vQF54K2rmFxXNJm_0Xg5m0`
- **ã‚·ãƒ¼ãƒˆID (gid)**: `503376053`

### 2. ãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ æ™‚ã®è‡ªå‹•åˆ—è¿½åŠ 

`HelperManager.tsx` ã§ã€æ–°ã—ã„ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ ã™ã‚‹éš›ã«ï¼š

1. **Firestoreã«ãƒ˜ãƒ«ãƒ‘ãƒ¼æƒ…å ±ã‚’ä¿å­˜**ï¼ˆæ—¢å­˜å‡¦ç†ï¼‰
2. **Google OAuthèªè¨¼ã‚’å®Ÿè¡Œ**ï¼ˆåˆå›ã®ã¿ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºï¼‰
3. **Google Sheets APIã§åˆ—ã‚’è¿½åŠ **
4. **ãƒ˜ãƒ«ãƒ‘ãƒ¼åã‚’ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã«è¨­å®š**

## å¿…è¦ãªè¨­å®š

### ã‚¹ãƒ†ãƒƒãƒ—1: Google Cloud Console ã§ Sheets API ã‚’æœ‰åŠ¹åŒ–

1. https://console.cloud.google.com/ ã‚’é–‹ã
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã¾ãŸã¯æ–°è¦ä½œæˆ
3. ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€
4. "Google Sheets API" ã‚’æ¤œç´¢
5. ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—2: OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½œæˆ

1. ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€
2. ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡: **ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**
4. åå‰: ã€Œã‚·ãƒ•ãƒˆç®¡ç†ã‚½ãƒ•ãƒˆã€
5. æ‰¿èªæ¸ˆã¿ã®JavaScriptç”Ÿæˆå…ƒ:
   ```
   http://localhost:5173
   https://your-production-domain.com
   ```
6. æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURI:
   ```
   http://localhost:5173
   https://your-production-domain.com
   ```
7. ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
8. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**ã¨**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã‚’ã‚³ãƒ”ãƒ¼

### ã‚¹ãƒ†ãƒƒãƒ—3: Firebase Console ã§ Google èªè¨¼ã‚’æœ‰åŠ¹åŒ–

1. https://console.firebase.google.com/ ã‚’é–‹ã
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `shift-management-2` ã‚’é¸æŠ
3. ã€ŒAuthenticationã€â†’ã€ŒSign-in methodã€ã‚¿ãƒ–
4. ã€ŒGoogleã€ã‚’é¸æŠ
5. ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ONã«åˆ‡ã‚Šæ›¿ãˆ
6. **ã‚¦ã‚§ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**: ã‚¹ãƒ†ãƒƒãƒ—2ã§å–å¾—ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’å…¥åŠ›
7. **ã‚¦ã‚§ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**: ã‚¹ãƒ†ãƒƒãƒ—2ã§å–å¾—ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å…¥åŠ›
8. ã€Œä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### ã‚¹ãƒ†ãƒƒãƒ—4: Firebaseè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°

`src/lib/firebase.ts` ã‚’ç¢ºèªã—ã¦ã€Googleèªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š

```typescript
// Googleèªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
export const googleProvider = new GoogleAuthProvider();
// Sheets APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’è¿½åŠ 
googleProvider.addScope('https://www.googleapis.com/auth/spreadsheets');
```

ã™ã§ã«è¨­å®šæ¸ˆã¿ã§ã™ã€‚

## ä½¿ã„æ–¹

### ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ ã™ã‚‹

1. ã‚·ãƒ•ãƒˆç®¡ç†ã‚½ãƒ•ãƒˆã§ã€Œãƒ˜ãƒ«ãƒ‘ãƒ¼ç®¡ç†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œ+ ãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ˜ãƒ«ãƒ‘ãƒ¼æƒ…å ±ã‚’å…¥åŠ›:
   - è‹—å­—ï¼ˆå¿…é ˆï¼‰
   - åï¼ˆä»»æ„ï¼‰
   - æ€§åˆ¥
4. ã€Œä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### åˆå›å®Ÿè¡Œæ™‚

åˆã‚ã¦ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ ã™ã‚‹éš›ã€Google OAuthèªè¨¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

1. **Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é¸æŠ**
2. **ã€Œã“ã®ã‚¢ãƒ—ãƒªã¯ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆ**:
   - ã€Œè©³ç´°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€Œï¼ˆã‚¢ãƒ—ãƒªåï¼‰ã«ç§»å‹•ï¼ˆå®‰å…¨ã§ã¯ãªã„ãƒšãƒ¼ã‚¸ï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **æ¨©é™ã®ç¢ºèªç”»é¢**:
   - ã€ŒGoogle ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®é–²è¦§ã€ç·¨é›†ã€ä½œæˆã€å‰Šé™¤ã€ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™
   - ã€Œè¨±å¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### è‡ªå‹•å‡¦ç†ã®æµã‚Œ

1. âœ… Firestoreã«ãƒ˜ãƒ«ãƒ‘ãƒ¼æƒ…å ±ãŒä¿å­˜ã•ã‚Œã‚‹
2. ğŸ” Google OAuthèªè¨¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆåˆå›ã®ã¿ï¼‰
3. ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«æ–°ã—ã„åˆ—ãŒè¿½åŠ ã•ã‚Œã‚‹
4. âœï¸ ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆ1è¡Œç›®ï¼‰ã«ãƒ˜ãƒ«ãƒ‘ãƒ¼åãŒè¨­å®šã•ã‚Œã‚‹
5. ğŸ”„ ã‚·ãƒ•ãƒˆè¡¨ã®iframeãŒè‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Failed to get access token from Google"

**åŸå› **: OAuthèªè¨¼ã«å¤±æ•—ã—ãŸ

**è§£æ±ºæ–¹æ³•**:
1. Firebase Consoleã§Googleèªè¨¼ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£CookieãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

### ã‚¨ãƒ©ãƒ¼: "Failed to insert column"

**åŸå› **: Google Sheets APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„

**è§£æ±ºæ–¹æ³•**:
1. Google Cloud Consoleã§Sheets APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
2. å†åº¦OAuthèªè¨¼ã‚’å®Ÿè¡Œï¼ˆã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã—ã¦ã‹ã‚‰å†åº¦ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ ï¼‰
3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã‚’ç¢ºèªï¼ˆç·¨é›†æ¨©é™ãŒã‚ã‚‹ã‹ï¼‰

### ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹

**åŸå› **: ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚«ãƒ¼ãŒæœ‰åŠ¹

**è§£æ±ºæ–¹æ³•**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å³ç«¯ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œã“ã®ã‚µã‚¤ãƒˆã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å¸¸ã«è¨±å¯ã€ã‚’é¸æŠ
3. ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å†åº¦ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¿½åŠ 

### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«åˆ—ãŒè¿½åŠ ã•ã‚Œãªã„

**åŸå› **: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã¾ãŸã¯ã‚·ãƒ¼ãƒˆIDãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
1. `src/services/googleSheetsApi.ts` ã‚’ç¢ºèª
2. `SPREADSHEET_ID` ã¨ `SHEET_ID` ãŒæ­£ã—ã„ã‹ç¢ºèª
3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‹ã‚‰æ­£ã—ã„IDã‚’å–å¾—:
   ```
   https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit?gid=[SHEET_ID]
   ```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„

âš ï¸ **é‡è¦**: OAuthèªè¨¼ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

- æœ¬ç•ªç’°å¢ƒã§ã¯ã€ä¿¡é ¼ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒãƒ˜ãƒ«ãƒ‘ãƒ¼ç®¡ç†æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªå†…ã§ã®ã¿ä¿æŒã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¤ã§ã‚‚Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã‹ã‚‰ã‚¢ãƒ—ãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã™

## ä»Šå¾Œã®æ‹¡å¼µ

### ãƒ˜ãƒ«ãƒ‘ãƒ¼å‰Šé™¤æ™‚ã®åˆ—å‰Šé™¤

ç¾åœ¨ã€ãƒ˜ãƒ«ãƒ‘ãƒ¼å‰Šé™¤æ™‚ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ã€‚ä»Šå¾Œã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã¾ã™ï¼š

```typescript
// HelperManager.tsx ã®å‰Šé™¤å‡¦ç†ã«è¿½åŠ 
const handleDeleteHelper = async (helperId: string) => {
  // ... æ—¢å­˜ã®å‰Šé™¤å‡¦ç† ...

  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰åˆ—ã‚’å‰Šé™¤
  const accessToken = await getGoogleAccessToken();
  await deleteHelperColumn(columnIndex, accessToken);
};
```

### ãƒ˜ãƒ«ãƒ‘ãƒ¼åå¤‰æ›´æ™‚ã®åˆ—åæ›´æ–°

ãƒ˜ãƒ«ãƒ‘ãƒ¼åã‚’å¤‰æ›´ã—ãŸéš›ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚‚è‡ªå‹•æ›´æ–°ã™ã‚‹æ©Ÿèƒ½ã€‚

### ãƒãƒƒãƒåŒæœŸ

å®šæœŸçš„ã«Firestoreã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’åŒæœŸã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿ã¤æ©Ÿèƒ½ã€‚

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `/Users/koike/Desktop/ã‚·ãƒ•ãƒˆ/shift-table/src/services/googleSheetsApi.ts` - Sheets APIæ“ä½œ
- `/Users/koike/Desktop/ã‚·ãƒ•ãƒˆ/shift-table/src/services/googleAuthService.ts` - OAuthèªè¨¼
- `/Users/koike/Desktop/ã‚·ãƒ•ãƒˆ/shift-table/src/components/ShiftTable.tsx` - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆåŸ‹ã‚è¾¼ã¿
- `/Users/koike/Desktop/ã‚·ãƒ•ãƒˆ/shift-table/src/components/HelperManager.tsx` - ãƒ˜ãƒ«ãƒ‘ãƒ¼ç®¡ç†ãƒ»åˆ—è¿½åŠ 

## æ›´æ–°å±¥æ­´

- 2025-12-30: åˆç‰ˆä½œæˆ
  - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆåŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½å®Ÿè£…
  - ãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ æ™‚ã®è‡ªå‹•åˆ—è¿½åŠ æ©Ÿèƒ½å®Ÿè£…
  - Google OAuthèªè¨¼çµ±åˆ
