# Google Apps Script 設定手順

個人シフト画面でGoogleスプレッドシートからデータを取得するための設定手順です。

## 1. スプレッドシートでApps Scriptエディタを開く

1. 対象のGoogleスプレッドシートを開く
   - URL: https://docs.google.com/spreadsheets/d/1hrNbQ3X9bkFqNe3zoZgs3vQF54K2rmFxXNJm_0Xg5m0/edit
2. メニューから「拡張機能」→「Apps Script」をクリック
3. 新しいタブでApps Scriptエディタが開きます

## 2. コードを貼り付け

1. エディタに既存のコード（`function myFunction() {}`など）がある場合は削除
2. `/Users/koike/Desktop/シフト/google-apps-script-api.gs` の内容をコピー
3. Apps Scriptエディタに貼り付け
4. 「保存」ボタン（💾アイコン）をクリック

## 3. ウェブアプリとして公開

1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」で「ウェブアプリ」を選択
3. 設定:
   - **説明**: 「個人シフトAPI」など任意の名前
   - **実行ユーザー**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」ボタンをクリック
5. 承認画面が表示される場合:
   - 「アクセスを承認」→ Googleアカウントを選択
   - 「詳細」→「安全ではないページに移動」をクリック
   - 「許可」をクリック
6. **ウェブアプリのURL**をコピー（例: `https://script.google.com/macros/s/...../exec`）

## 4. コードにURLを設定

1. `/Users/koike/Desktop/シフト/shift-table/src/components/PersonalShift.tsx` を開く
2. 110行目付近の以下の行を探す:
   ```typescript
   const API_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
   ```
3. `'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'` を先ほどコピーしたURLに置き換え:
   ```typescript
   const API_URL = 'https://script.google.com/macros/s/...../exec';
   ```
4. ファイルを保存

## 5. 動作確認

1. 個人シフトのURLにアクセス（例: `http://localhost:5173/personal/トークン`）
2. ブラウザの開発者ツール（F12）→「Console」タブを開く
3. 以下のログが表示されることを確認:
   ```
   📥 スプレッドシートからデータ取得開始: ヘルパー名
   ✅ スプレッドシートからデータ取得成功: X件
   ```
4. シフトデータが表示されることを確認

## トラブルシューティング

### エラー: "Sheet not found"

- スプレッドシートのシート名とヘルパーの名前が一致しているか確認
- ヘルパー管理画面でヘルパー名を確認
- スプレッドシートのシート名（タブ名）を確認

### エラー: "HTTP error! status: 403"

- Apps Scriptの公開設定で「アクセスできるユーザー」が「全員」になっているか確認
- 再度デプロイし直す（「デプロイ」→「デプロイを管理」→「編集」→「バージョン：新バージョン」→「デプロイ」）

### データが表示されない

1. ブラウザのコンソールでエラーメッセージを確認
2. スプレッドシートのデータ形式が正しいか確認:
   - 各セルに以下の形式でデータが入っているか
     ```
     11:30-13:00
     美野(家事)
     1.5
     城東区
     ```
3. Apps Scriptのログでデータがパースされているか確認:
   - Apps Scriptエディタ →「実行ログ」を確認

## 仕様

### スプレッドシートのデータ形式

各セル（シフト1件）には以下の形式で4行のデータが必要:

```
[1行目] 時間範囲（例: 11:30-13:00）
[2行目] 利用者名(サービス種別)（例: 美野(家事)）
[3行目] 稼働時間（例: 1.5）
[4行目] エリア（例: 城東区）
```

### 対応サービス種別

- 家事 → kaji
- 重度 → judo
- 身体 → shintai
- 同行 → doko
- 行動 → kodo_engo
- 通院 → tsuin
- 移動 → ido
- 事務 → jimu
- 営業 → eigyo

## 更新履歴

- 2025-12-30: 初版作成
