<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        #output {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Google Sheets API ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</h1>

    <div>
        <button onclick="fetchData()">ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
        <button onclick="clearOutput()">ã‚¯ãƒªã‚¢</button>
    </div>

    <div id="status"></div>
    <div id="output"></div>

    <script>
        const CONFIG = {
            apiKey: 'AIzaSyDRoNhwY5oaRolDEp9eUny8_B3l9aTFZ2w',
            spreadsheetId: '1718uvoE5eVthZqypmrbFyHj92T30uSogMSsdSF8-wpA',
            sheetName: 'ğŸ”´ã€ä»Šæœˆã€‘25.10æœˆ'
        };

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status ' + (isError ? 'error' : 'success');
            statusDiv.textContent = message;
        }

        function showOutput(data) {
            const outputDiv = document.getElementById('output');
            outputDiv.textContent = JSON.stringify(data, null, 2);
        }

        function clearOutput() {
            document.getElementById('output').textContent = '';
            document.getElementById('status').textContent = '';
        }

        async function fetchData() {
            try {
                showStatus('ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');

                const range = `${CONFIG.sheetName}!A1:ZZ1000`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.spreadsheetId}/values/${encodeURIComponent(range)}?key=${CONFIG.apiKey}`;

                console.log('ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL:', url);

                const response = await fetch(url);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();

                console.log('å–å¾—æˆåŠŸ:', data);
                showStatus(`ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼ è¡Œæ•°: ${data.values?.length || 0}`);
                showOutput(data);

                // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ¢ã™
                if (data.values && data.values.length > 0) {
                    console.log('=== ãƒ‡ãƒ¼ã‚¿æ§‹é€ åˆ†æ ===');
                    console.log('ç·è¡Œæ•°:', data.values.length);
                    console.log('æœ€åˆã®10è¡Œ:', data.values.slice(0, 10));

                    // ä»Šæ—¥ã®æ—¥ä»˜ (ä¾‹: 15)
                    const today = new Date().getDate();
                    console.log('ä»Šæ—¥ã®æ—¥ä»˜:', today);

                    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ç¢ºèª
                    const headerRow = data.values[0];
                    console.log('ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ:', headerRow);

                    // ä»Šæ—¥ã®åˆ—ã‚’æ¢ã™
                    let todayColIndex = -1;
                    for (let i = 0; i < headerRow.length; i++) {
                        const cell = String(headerRow[i] || '');
                        if (cell.includes(`${today}(`)) {
                            todayColIndex = i;
                            console.log(`ä»Šæ—¥(${today}æ—¥)ã®åˆ—ã‚’ç™ºè¦‹: åˆ—${i}`);
                            break;
                        }
                    }

                    if (todayColIndex >= 0) {
                        console.log('\n=== ä»Šæ—¥ã®ã‚±ã‚¢å†…å®¹ ===');
                        for (let row = 0; row < Math.min(50, data.values.length); row++) {
                            const rowData = data.values[row];
                            if (rowData[todayColIndex]) {
                                console.log(`è¡Œ${row}: ${rowData[todayColIndex]}`);
                            }
                        }
                    }
                }

            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                showStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
                showOutput({ error: error.message, stack: error.stack });
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            showStatus('ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>
